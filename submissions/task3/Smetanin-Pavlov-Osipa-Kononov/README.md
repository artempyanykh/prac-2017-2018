# Задание prac-io-3 
-----

## Краткое описание задания

На основании данных о закупках, продажах и инвентаре, доступных в формате CSV получить следующие сведения:
1. Состояние склада на каждый день.
2. Месячные данные о количестве сворованного товара.
3. Агрегированные данные об объемах продаж и количестве сворованной продукции по штату и году.
Данные предоставить в формате CSV.


## Файлы проекта:
- **zadanie3.ipynb** --- программма, реализующая задание;
- **README. md** --- описание проекта;
- Исходные данные, на которых выполняется программа, доступны [по ссылке](https://console.cloud.google.com/storage/browser/artem-pyanykh-cmc-prac-task3-seed17/);
- Полученные результаты доступны в папке **results/** в директории проекта.

# Подход к решению


Каждый файл соответствует шаблону **MS-state-what.csv** , где
- **state** --- штат, в котором расположен магазин;
- **what** --- содержимое файла(3 варианта):
  1. *inventory* --- данные о товаре (apple, pen) на складе за каждый месяц, запись осуществляется в последний день месяца.
    Запись состоит из:
     - date - дата проверки состояния склада;
     - apple - количество яблок на складе;
     - pen - количество ручек на складе.
  2. *sell* --- лог транзакций -- данные о продаже товара, по записи на каждую проданную позицию.
    Запись состоит из:  
      - date -- дата продажи;
      - sku_num -- информация о продаже, имеет вид: **MS-state-product-id**, где
        - **state** -- штат;
        - **product** - ap/pe -- какой товар был продан(яблоко/ручка);
        - **id** -- идентификационный номер продажи.
  3. *supply* --- данные о закупках на склад, произодящихся 2 раза в месяц: 1 и 15 числа каждого месяца.
    Запись состоит из:
     - date - дата поставки;
     - apple - количество поставленных яблок;
     - pen - количество поставленных ручек.

Исходя из шаблонности названия файлов, реализована функция **work(statename)**, в которую передаётся только название штата. Для каждого штата производится аналогичная обработка данных.




--------
# Реализация решения
Считаем, что непосредственно перед первой поставкой товаров склады были пустые.
### 1. Состояние склада на каждый день

Создаём объект `df` типа `DataFrame`, который будет нести информацию о складе на каждый день. Для того, чтобы заполнить данные об одном дне:
  - если это не самый первый день, копируем значения предыдущего дня;
  - прибавляем количество завезённых на склад товаров 1 и 15 числа каждого месяца;
  - вычитаем количество проданных за каждый день товаров;
  - в последний день месяца копируем значение из inventory.

Заполнив все даты, получаем файл **MS-state-daily.csv**, соответствующий штату **state**.
Структура файла следующая:
Date      | Apple | Pen
-------- |:-----:| :-------:
2006-01-01  | 33271  | 2574
2006-01-02  | 31409  | 2431
...    |     | 
2015-12-31|1569425|122601
### 2. Месячные данные о количестве сворованного товара

Создаём объект `df_steal` типа `DataFrame`, который будет нести информацию о сворованном товаре. Данные должны быть предоставлены за последний день каждого месяца. Необходимая информация вычисляется следующим образом:
*'количесвто сворованного товара' = 'количество товара согласно `df` ' - 'количество товара согласно **inventory**'*.

Результат выводится в файл **MS-state-steal.csv**, соответствующий штату **state**.
Структура файла следующая:
Date      | Apple | Pen
-------- |:-----:| :-------:
2006-01-31|10|11
2006-02-28|6|6
...    |     |  
2015-12-31|7|7
### 3. Агрегированные данные об объемах продаж и количестве сворованной продукции по штату и году

Создаём объект `d3` типа `DataFrame`, который будет нести информацию об объемах продаж и количестве сворованной продукции по штату и году. Изначально все данные обнулены.

  - пока идёт текущий год в текущем штате:
    - увеличиваем на 1 число продаж ручек/яблок за каждую запись в логе транзакций в текущем году;
    - каждый раз когда вычисляем количество сворованного товара в конце месяца, прибавляем это же число и к количеству сворованного товара в `d3`.

Заполнив всю необходимую информацию о каждом штате, выводим её в файл **agregate.csv**.

Структура файла следующая:
year|state|apple_sold | apple_stolen|pen_sold|pen_stolen
-------- |:-----:| :-------:| :-------:| :-------:| :-------:
2006|b1|681341|78|52555|91
2007|b1|681281|68|51939|76
...    |     |  
2015|b1|681763|77|51804|77
2006|b2|681341|78|52555|91
...    |     |  
2015|s4|33879|26|3575|26

### Используемая версия Python

- Python 3.6.1

### Используемые библиотеки
- **pandas**
  - pandas.read_csv('testing.csv', sep=', ', parse_dates=['Date'], index_col='Date') – считывает данные из csv-файла.
    - 'testing.csv' -- название файла; 
    - sep=', ' -- разделитель полей; 
    - parse_dates=['Date'] -- указывает название колонки, в которой находятся даты; 
    - index_col='Date' -- изменят индекс на значения в колонке 'Date';
  - pandas.DataFrame(data, index, columns) -- создаёт объект класса DataFrame
  - pandas.DataFrame.iloc[i] -- выбор "строки" i в DataFrame
  - pandas.date_range(start, end, freq='D') -- создаёт список, состоящий из дат, начиная с start, по end; freq - шаг (D = day)
  - pandas.DataFrame.to_csv(path) -- выводит данные из DataFrame в csv-файл с именем path


### Необходимое ПО
  - *Jupyter Notebook*
  - *Python*
  - *Google Cloud SDK* 

### Использование Google Cloud SDK
Google Cloud SDK --- это набор инструментов, позволяющий управлять ресурсами, размещёнными на Google Cloud Platform. Документация и установка доступны [по ссылке](https://cloud.google.com/sdk/docs/).
**gcloud** - пакет консольных инструментов, являющийся частью Google Cloud SDK. Команда gsutil используется для доступа к данным в Google Storage.
Использование:
- для получения исходных данных: 
`gsutil -m cp -R gs://artem-pyanykh-cmc-prac-task3-seed17`

### Запуск программы

В директории проекта должна находиться папка `out/`, содержащая необходимые для работы программы данные *(см. 'Файлы проекта', 'Использование gcloud')*.
В *Jupyter Notebook:* 
  - открываем файл **zadanie3.ipynb**;
  - `Cell -> Run All`.
---
**Задание выполнили:**
*Павлов Антон*
*Сметанин Даниил*
*Кононов Сергей*
*Осипа Андрей*